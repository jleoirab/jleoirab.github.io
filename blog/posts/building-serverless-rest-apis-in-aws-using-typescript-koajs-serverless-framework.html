<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Building Serverless REST APIs in AWS using Typescript KoaJS and the Serverless Framework</title><meta name="description" content="This post is about the serverless architecture and how I used it to build serverless APIs with KoaJs and the Serverless Framework using AWS. It also introduces a Serverless Framework Typescript template that can be used to easily spin up a new KoaJS application running on AWS using AWS Lambda and exposed via the Amazon API Gateway."/><meta name="robots" content="index, archive"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Joshua LEO-Irabor | Building Serverless REST APIs in AWS using Typescript KoaJS and the Serverless Framework"/><meta name="twitter:description" content="This post is about the serverless architecture and how I used it to build serverless APIs with KoaJs and the Serverless Framework using AWS. It also introduces a Serverless Framework Typescript template that can be used to easily spin up a new KoaJS application running on AWS using AWS Lambda and exposed via the Amazon API Gateway."/><meta property="og:title" content="Joshua LEO-Irabor | Building Serverless REST APIs in AWS using Typescript KoaJS and the Serverless Framework"/><meta property="og:description" content="This post is about the serverless architecture and how I used it to build serverless APIs with KoaJs and the Serverless Framework using AWS. It also introduces a Serverless Framework Typescript template that can be used to easily spin up a new KoaJS application running on AWS using AWS Lambda and exposed via the Amazon API Gateway."/><meta property="og:url" content="https://leoiraborjoshua.me/blog/posts/building-serverless-rest-apis-in-aws-using-typescript-koajs-serverless-framework"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="keywords" content="serverless,koajs,serverless framework,AWS,FaaS"/><meta name="next-head-count" content="12"/><link rel="preload" href="/_next/static/css/abeec29acdde00c9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/abeec29acdde00c9.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script><script src="/_next/static/chunks/main-f65e66e62fc5ca80.js" defer=""></script><script src="/_next/static/chunks/pages/_app-578e6063cd1ff136.js" defer=""></script><script src="/_next/static/chunks/664-41844e7ff48658f9.js" defer=""></script><script src="/_next/static/chunks/pages/blog/posts/%5Bid%5D-0147b860ef6fd48a.js" defer=""></script><script src="/_next/static/uOC6ZXMUw1CmzP934OMBS/_buildManifest.js" defer=""></script><script src="/_next/static/uOC6ZXMUw1CmzP934OMBS/_ssgManifest.js" defer=""></script><script src="/_next/static/uOC6ZXMUw1CmzP934OMBS/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="h-full w-full"><header class="px-8 w-full h-24 flex items-center"><span class="logo text-3xl cursor-pointer select-none">Joshua LEO-Irabor</span></header><main class="prose max-w-none"><h1>Building Serverless REST APIs in AWS using Typescript KoaJS and the Serverless Framework</h1><h5>2022-09-18</h5><article><p>While at <a href="https://joincolab.io">Co.Lab</a>, we wanted to train people looking propel their tech careers and in order to scale out our training we decided to build tools to reduce the amount of human effort required to facilitate our programs. Part of the tools we built was a collaborative learning platform where students could watch their pre-recorded lessons together (think Netflix watch parties but for education) complemented by collaborative documents for students to participate in lesson activities together. I like to use the term "synchronized lesson content delivery" to describe it.</p>
<p>While I was there, the technology stack for building our tools was:</p>
<ul>
<li>Typescript as the programming language across backend and frontend</li>
<li>KoaJS as our web application framework</li>
<li>ReactJS for frontend development</li>
<li>DynamoDB for the database</li>
<li>AWS serverless architecture using AWS API Gateway &#x26; AWS Lambda</li>
<li>Serverless for configuration management</li>
</ul>
<p>In this post, I'd like to briefly introduce you to the Serverless Architecture and how we built a serverless APIs with KoaJS and the Serverless Framework using AWS as our Cloud Service Provider.</p>
<h2>Serverless Architecture</h2>
<p>The Serverless architecture is a method of software application design that enables you build and run your applications without having to worry about managing software infrastructure. It takes away concerns such as what machines (physical or virtual) that the application will run on, how many they are and all the details involved with scaling it.</p>
<p>Cloud Service Providers usually provide services that enable developers build serverless applications. For example, Amazon Web Services (AWS) has <a href="https://aws.amazon.com/lambda/">AWS Lambda</a> which is used in conjuction with <a href="https://aws.amazon.com/api-gateway/">Amazon API Gateway</a> to provide serverless based web APIs. Google Cloud Platform (GCP) has <a href="https://cloud.google.com/functions">Cloud Functions</a>, <a href="https://cloud.google.com/run">Cloud Run</a> and <a href="https://cloud.google.com/appengine">App Engine</a> to enable developers build different types serverless computing workloads. Also, Microsoft Azure has <a href="https://azure.microsoft.com/en-ca/services/functions/">Azure Functions</a> as their serverless offering too. Serverless products offered by Cloud Service Providers are usually categorized as Function as a Service (Faas).S</p>
<p>Given that we're a young startup, it's important to be cost-effective with our design decisions. It's important to us that we don't consume more resources than we need but still be able to adapt and evolve to growing demand our services. Cloud Service Providers usually have a request-based cost model such that you're charged by the number of requests your services handle, taking into account the amount of time that your services use compute resources to handle the requests. serverless platforms do their best to spin up and down the compute resources you use so as to not add extra latency for your requests and so that you don't get charged when your service isn't doing anything.</p>
<p>Another great benefit with serverless architectures is the ability to detect increase in traffic and smoothly scale up resources to handle the increase. Say you have an ecommerce site for your small business and then you run a small promo on instagram for a Black Friday sale which gathers a lot of attention. If tons of people flock to your site, most serverless platforms can detect this and scale up to handle the increased traffic.</p>
<p>I've found though that as your service's load increases, there comes a point where it's just more cost effective to have a dedicated set of compute resources (servers, or nodes or pods depending on your underlying deployment model) running or in stand by to handle your requests. However, serverless is really great for bootstrapping applications and providing value quickly in a cost effective manner.</p>
<p>At the heart of the serverless architecture are serverless functions which is are pieces of ephemeral and stateless business logic software hosted on some managed infrastructure. The infrastructure providers take care of providing an interface to invoke these functions. They also take care of scalability concerns as the number of invocations of your function increases. Imagine you've built a whole javascript application with tons of important functions doing important business logic. Serverless architecture essentially enables you to deploy each of those functions as individual lightweight applications.</p>
<h2>KoaJS</h2>
<p><a href="https://koajs.com/">KoaJS</a> is a node.js web framework built by the creators of express.js - the OG node.js web framework. It's really great for building web applications and APIs. It leverages the (async/await) functions rather than callbacks which encourages easier-to-follow code.</p>
<h2>Serverless Framework</h2>
<p>The <a href="https://serverless.com/framework">Serverless framework</a> provides an easy and open way to build serverless applications. It allows you to define your serverless infrastructure and all it's resources using a cloud service provider agnostic representation. The serverless framework makes it super easy to do CI/CD because once you've defined your applications serverless resources using the framework, deployments and updates are as easy as one CLI command.</p>
<p>For users of KoaJS with TypeScript, in this blog post, I'll introduce you to a serverless template to help you get up and running with a TypeScript KoaJS application for deployment <a href="https://aws.amazon.com/lambda/">AWS Lambda</a> and exposed via <a href="https://aws.amazon.com/api-gateway/">AWS API Gateway</a>.</p>
<p>When using the serverless framework with AWS, it leverages common AWS services to make your application accessible over the internet.</p>
<p>You can find the full template <a href="https://github.com/jleoirab/serverless-aws-koajs-typescript-template">here</a>. It leverages the serverless Typescript API to declare your serverless resources.</p>
<p>At the top level is the <code>serverless.ts</code> file which is the entry point for the serverless framework configuration.</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-variable constant_">AWS</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@serverless/typescript'</span>;

<span class="hljs-keyword">import</span> api <span class="hljs-keyword">from</span> <span class="hljs-string">'@functions/api'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">serverlessConfiguration</span>: <span class="hljs-variable constant_">AWS</span> = {
  <span class="hljs-attr">service</span>: <span class="hljs-string">'aws-koajs-typescript-template'</span>,
  <span class="hljs-attr">frameworkVersion</span>: <span class="hljs-string">'2'</span>,
  <span class="hljs-attr">custom</span>: {
    <span class="hljs-attr">webpack</span>: {
      <span class="hljs-attr">webpackConfig</span>: <span class="hljs-string">'./webpack.config.js'</span>,
      <span class="hljs-attr">includeModules</span>: <span class="hljs-literal">true</span>,
    },
  },
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-string">'serverless-webpack'</span>,
    <span class="hljs-string">'serverless-dotenv-plugin'</span>,
  ],
  <span class="hljs-attr">provider</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'aws'</span>,
    <span class="hljs-attr">runtime</span>: <span class="hljs-string">'nodejs16.x'</span>,
    <span class="hljs-attr">apiGateway</span>: {
      <span class="hljs-attr">minimumCompressionSize</span>: <span class="hljs-number">1024</span>,
      <span class="hljs-attr">shouldStartNameWithService</span>: <span class="hljs-literal">true</span>,
    },
    <span class="hljs-attr">environment</span>: {
      <span class="hljs-attr">AWS_NODEJS_CONNECTION_REUSE_ENABLED</span>: <span class="hljs-string">'1'</span>,
    },
    <span class="hljs-attr">lambdaHashingVersion</span>: <span class="hljs-string">'20201221'</span>,
  },
  <span class="hljs-comment">// import the function via paths</span>
  <span class="hljs-attr">functions</span>: { api },
};

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = serverlessConfiguration;
</code></pre>
<p>The <code>functions</code> property outlines a set of serverless functions. In this approach we'll be deploying a while KoaJS Typescript application as a serverless function. So, the layout of our architecture will look like this:</p>
<p><img src="/images/serverless-with-aws-and-serverlessjs.png" alt="image"></p>
<p>The <code>api</code> function configuration looks like this:</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> { handlerPath } <span class="hljs-keyword">from</span> <span class="hljs-string">'@libs/handlerResolver'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">handler</span>: <span class="hljs-string">`<span class="hljs-subst">${handlerPath(__dirname)}</span>/handler.main`</span>,
  <span class="hljs-attr">events</span>: [
    {
      <span class="hljs-attr">http</span>: {
        <span class="hljs-attr">method</span>: <span class="hljs-string">'ANY'</span>,
        <span class="hljs-comment">// this matches the base path</span>
        <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
      },
    },
    {
      <span class="hljs-attr">http</span>: {
        <span class="hljs-attr">method</span>: <span class="hljs-string">'ANY'</span>,
        <span class="hljs-comment">// this matches any path, the token 'any' doesn't mean anything special</span>
        <span class="hljs-attr">path</span>: <span class="hljs-string">'/{any+}'</span>,
      },
    },
  ],
}
</code></pre>
<p>This leverages the Typescript serverless API to define a function to handle all HTTP events. In AWS terms, this creates an AWS API Gateway endpoint that listenes to all HTTP events. These events are then passed to an AWS Lambda which will house your KoaJS application. This application will then handle the HTTP event accordingly.</p>
<p>The Serverless framework provides an API to convert AWS http events into requests that your KoaJS application can understand and handle. This API documentation can be found <a href="https://www.serverless.com/plugins/serverless-http">here</a>. You can wrap your KoaJS server in a Serverless HTTP handler like so:</p>
<pre><code class="hljs language-ts"><span class="hljs-keyword">import</span> <span class="hljs-title class_">ServerlessHttp</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'serverless-http'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Koa</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'koa'</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();

<span class="hljs-comment">// installation of your routes</span>


<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">main</span>: <span class="hljs-title class_">ServerlessHttp</span>.<span class="hljs-property">Handler</span> = <span class="hljs-title class_">ServerlessHttp</span>(app, {});
</code></pre>
<p>Feel free to take a deeper look at the template <a href="https://github.com/jleoirab/serverless-aws-koajs-typescript-template">here</a>. You can also make use of it in your next project.</p>
<p>First off, you'll need to install serverless. You can check out the serverless installation instructions <a href="https://www.serverless.com/framework/docs/getting-started">here</a>.</p>
<p>With that, you just need to run:</p>
<pre><code class="hljs language-bash">serverless create \
  --template-url https://github.com/jleoirab/serverless-aws-koajs-typescript-template
  --path my-service
</code></pre>
<p>And then, ensure to install all the npm dependencies:</p>
<pre><code class="hljs language-bash"><span class="hljs-built_in">cd</span> my-service &#x26;&#x26; npm i
</code></pre>
<p>That's it!</p></article></main></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"blogPost":{"id":"building-serverless-rest-apis-in-aws-using-typescript-koajs-serverless-framework","title":"Building Serverless REST APIs in AWS using Typescript KoaJS and the Serverless Framework","date":"2022-09-18","summary":"This post is about the serverless architecture and how I used it to build serverless APIs with KoaJs and the Serverless Framework using AWS. It also introduces a Serverless Framework Typescript template that can be used to easily spin up a new KoaJS application running on AWS using AWS Lambda and exposed via the Amazon API Gateway.","tags":["serverless","koajs","serverless framework","AWS","FaaS"],"content":"\u003cp\u003eWhile at \u003ca href=\"https://joincolab.io\"\u003eCo.Lab\u003c/a\u003e, we wanted to train people looking propel their tech careers and in order to scale out our training we decided to build tools to reduce the amount of human effort required to facilitate our programs. Part of the tools we built was a collaborative learning platform where students could watch their pre-recorded lessons together (think Netflix watch parties but for education) complemented by collaborative documents for students to participate in lesson activities together. I like to use the term \"synchronized lesson content delivery\" to describe it.\u003c/p\u003e\n\u003cp\u003eWhile I was there, the technology stack for building our tools was:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eTypescript as the programming language across backend and frontend\u003c/li\u003e\n\u003cli\u003eKoaJS as our web application framework\u003c/li\u003e\n\u003cli\u003eReactJS for frontend development\u003c/li\u003e\n\u003cli\u003eDynamoDB for the database\u003c/li\u003e\n\u003cli\u003eAWS serverless architecture using AWS API Gateway \u0026#x26; AWS Lambda\u003c/li\u003e\n\u003cli\u003eServerless for configuration management\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIn this post, I'd like to briefly introduce you to the Serverless Architecture and how we built a serverless APIs with KoaJS and the Serverless Framework using AWS as our Cloud Service Provider.\u003c/p\u003e\n\u003ch2\u003eServerless Architecture\u003c/h2\u003e\n\u003cp\u003eThe Serverless architecture is a method of software application design that enables you build and run your applications without having to worry about managing software infrastructure. It takes away concerns such as what machines (physical or virtual) that the application will run on, how many they are and all the details involved with scaling it.\u003c/p\u003e\n\u003cp\u003eCloud Service Providers usually provide services that enable developers build serverless applications. For example, Amazon Web Services (AWS) has \u003ca href=\"https://aws.amazon.com/lambda/\"\u003eAWS Lambda\u003c/a\u003e which is used in conjuction with \u003ca href=\"https://aws.amazon.com/api-gateway/\"\u003eAmazon API Gateway\u003c/a\u003e to provide serverless based web APIs. Google Cloud Platform (GCP) has \u003ca href=\"https://cloud.google.com/functions\"\u003eCloud Functions\u003c/a\u003e, \u003ca href=\"https://cloud.google.com/run\"\u003eCloud Run\u003c/a\u003e and \u003ca href=\"https://cloud.google.com/appengine\"\u003eApp Engine\u003c/a\u003e to enable developers build different types serverless computing workloads. Also, Microsoft Azure has \u003ca href=\"https://azure.microsoft.com/en-ca/services/functions/\"\u003eAzure Functions\u003c/a\u003e as their serverless offering too. Serverless products offered by Cloud Service Providers are usually categorized as Function as a Service (Faas).S\u003c/p\u003e\n\u003cp\u003eGiven that we're a young startup, it's important to be cost-effective with our design decisions. It's important to us that we don't consume more resources than we need but still be able to adapt and evolve to growing demand our services. Cloud Service Providers usually have a request-based cost model such that you're charged by the number of requests your services handle, taking into account the amount of time that your services use compute resources to handle the requests. serverless platforms do their best to spin up and down the compute resources you use so as to not add extra latency for your requests and so that you don't get charged when your service isn't doing anything.\u003c/p\u003e\n\u003cp\u003eAnother great benefit with serverless architectures is the ability to detect increase in traffic and smoothly scale up resources to handle the increase. Say you have an ecommerce site for your small business and then you run a small promo on instagram for a Black Friday sale which gathers a lot of attention. If tons of people flock to your site, most serverless platforms can detect this and scale up to handle the increased traffic.\u003c/p\u003e\n\u003cp\u003eI've found though that as your service's load increases, there comes a point where it's just more cost effective to have a dedicated set of compute resources (servers, or nodes or pods depending on your underlying deployment model) running or in stand by to handle your requests. However, serverless is really great for bootstrapping applications and providing value quickly in a cost effective manner.\u003c/p\u003e\n\u003cp\u003eAt the heart of the serverless architecture are serverless functions which is are pieces of ephemeral and stateless business logic software hosted on some managed infrastructure. The infrastructure providers take care of providing an interface to invoke these functions. They also take care of scalability concerns as the number of invocations of your function increases. Imagine you've built a whole javascript application with tons of important functions doing important business logic. Serverless architecture essentially enables you to deploy each of those functions as individual lightweight applications.\u003c/p\u003e\n\u003ch2\u003eKoaJS\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://koajs.com/\"\u003eKoaJS\u003c/a\u003e is a node.js web framework built by the creators of express.js - the OG node.js web framework. It's really great for building web applications and APIs. It leverages the (async/await) functions rather than callbacks which encourages easier-to-follow code.\u003c/p\u003e\n\u003ch2\u003eServerless Framework\u003c/h2\u003e\n\u003cp\u003eThe \u003ca href=\"https://serverless.com/framework\"\u003eServerless framework\u003c/a\u003e provides an easy and open way to build serverless applications. It allows you to define your serverless infrastructure and all it's resources using a cloud service provider agnostic representation. The serverless framework makes it super easy to do CI/CD because once you've defined your applications serverless resources using the framework, deployments and updates are as easy as one CLI command.\u003c/p\u003e\n\u003cp\u003eFor users of KoaJS with TypeScript, in this blog post, I'll introduce you to a serverless template to help you get up and running with a TypeScript KoaJS application for deployment \u003ca href=\"https://aws.amazon.com/lambda/\"\u003eAWS Lambda\u003c/a\u003e and exposed via \u003ca href=\"https://aws.amazon.com/api-gateway/\"\u003eAWS API Gateway\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eWhen using the serverless framework with AWS, it leverages common AWS services to make your application accessible over the internet.\u003c/p\u003e\n\u003cp\u003eYou can find the full template \u003ca href=\"https://github.com/jleoirab/serverless-aws-koajs-typescript-template\"\u003ehere\u003c/a\u003e. It leverages the serverless Typescript API to declare your serverless resources.\u003c/p\u003e\n\u003cp\u003eAt the top level is the \u003ccode\u003eserverless.ts\u003c/code\u003e file which is the entry point for the serverless framework configuration.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e { \u003cspan class=\"hljs-variable constant_\"\u003eAWS\u003c/span\u003e } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@serverless/typescript'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e api \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@functions/api'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eserverlessConfiguration\u003c/span\u003e: \u003cspan class=\"hljs-variable constant_\"\u003eAWS\u003c/span\u003e = {\n  \u003cspan class=\"hljs-attr\"\u003eservice\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'aws-koajs-typescript-template'\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eframeworkVersion\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'2'\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003ecustom\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003ewebpack\u003c/span\u003e: {\n      \u003cspan class=\"hljs-attr\"\u003ewebpackConfig\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'./webpack.config.js'\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eincludeModules\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    },\n  },\n  \u003cspan class=\"hljs-attr\"\u003eplugins\u003c/span\u003e: [\n    \u003cspan class=\"hljs-string\"\u003e'serverless-webpack'\u003c/span\u003e,\n    \u003cspan class=\"hljs-string\"\u003e'serverless-dotenv-plugin'\u003c/span\u003e,\n  ],\n  \u003cspan class=\"hljs-attr\"\u003eprovider\u003c/span\u003e: {\n    \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'aws'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eruntime\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'nodejs16.x'\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003eapiGateway\u003c/span\u003e: {\n      \u003cspan class=\"hljs-attr\"\u003eminimumCompressionSize\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e1024\u003c/span\u003e,\n      \u003cspan class=\"hljs-attr\"\u003eshouldStartNameWithService\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    },\n    \u003cspan class=\"hljs-attr\"\u003eenvironment\u003c/span\u003e: {\n      \u003cspan class=\"hljs-attr\"\u003eAWS_NODEJS_CONNECTION_REUSE_ENABLED\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e,\n    },\n    \u003cspan class=\"hljs-attr\"\u003elambdaHashingVersion\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'20201221'\u003c/span\u003e,\n  },\n  \u003cspan class=\"hljs-comment\"\u003e// import the function via paths\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003efunctions\u003c/span\u003e: { api },\n};\n\n\u003cspan class=\"hljs-variable language_\"\u003emodule\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eexports\u003c/span\u003e = serverlessConfiguration;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThe \u003ccode\u003efunctions\u003c/code\u003e property outlines a set of serverless functions. In this approach we'll be deploying a while KoaJS Typescript application as a serverless function. So, the layout of our architecture will look like this:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/serverless-with-aws-and-serverlessjs.png\" alt=\"image\"\u003e\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003eapi\u003c/code\u003e function configuration looks like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e { handlerPath } \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'@libs/handlerResolver'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003edefault\u003c/span\u003e {\n  \u003cspan class=\"hljs-attr\"\u003ehandler\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e`\u003cspan class=\"hljs-subst\"\u003e${handlerPath(__dirname)}\u003c/span\u003e/handler.main`\u003c/span\u003e,\n  \u003cspan class=\"hljs-attr\"\u003eevents\u003c/span\u003e: [\n    {\n      \u003cspan class=\"hljs-attr\"\u003ehttp\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003emethod\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'ANY'\u003c/span\u003e,\n        \u003cspan class=\"hljs-comment\"\u003e// this matches the base path\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'/'\u003c/span\u003e,\n      },\n    },\n    {\n      \u003cspan class=\"hljs-attr\"\u003ehttp\u003c/span\u003e: {\n        \u003cspan class=\"hljs-attr\"\u003emethod\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'ANY'\u003c/span\u003e,\n        \u003cspan class=\"hljs-comment\"\u003e// this matches any path, the token 'any' doesn't mean anything special\u003c/span\u003e\n        \u003cspan class=\"hljs-attr\"\u003epath\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'/{any+}'\u003c/span\u003e,\n      },\n    },\n  ],\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis leverages the Typescript serverless API to define a function to handle all HTTP events. In AWS terms, this creates an AWS API Gateway endpoint that listenes to all HTTP events. These events are then passed to an AWS Lambda which will house your KoaJS application. This application will then handle the HTTP event accordingly.\u003c/p\u003e\n\u003cp\u003eThe Serverless framework provides an API to convert AWS http events into requests that your KoaJS application can understand and handle. This API documentation can be found \u003ca href=\"https://www.serverless.com/plugins/serverless-http\"\u003ehere\u003c/a\u003e. You can wrap your KoaJS server in a Serverless HTTP handler like so:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-ts\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eServerlessHttp\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'serverless-http'\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eKoa\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e'koa'\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eKoa\u003c/span\u003e();\n\n\u003cspan class=\"hljs-comment\"\u003e// installation of your routes\u003c/span\u003e\n\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003emain\u003c/span\u003e: \u003cspan class=\"hljs-title class_\"\u003eServerlessHttp\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eHandler\u003c/span\u003e = \u003cspan class=\"hljs-title class_\"\u003eServerlessHttp\u003c/span\u003e(app, {});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eFeel free to take a deeper look at the template \u003ca href=\"https://github.com/jleoirab/serverless-aws-koajs-typescript-template\"\u003ehere\u003c/a\u003e. You can also make use of it in your next project.\u003c/p\u003e\n\u003cp\u003eFirst off, you'll need to install serverless. You can check out the serverless installation instructions \u003ca href=\"https://www.serverless.com/framework/docs/getting-started\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eWith that, you just need to run:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003eserverless create \\\n  --template-url https://github.com/jleoirab/serverless-aws-koajs-typescript-template\n  --path my-service\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd then, ensure to install all the npm dependencies:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003e\u003cspan class=\"hljs-built_in\"\u003ecd\u003c/span\u003e my-service \u0026#x26;\u0026#x26; npm i\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThat's it!\u003c/p\u003e"}},"__N_SSG":true},"page":"/blog/posts/[id]","query":{"id":"building-serverless-rest-apis-in-aws-using-typescript-koajs-serverless-framework"},"buildId":"uOC6ZXMUw1CmzP934OMBS","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>